name: top embedding model pr

on:
    pull_request:
        branches: [ main ]

env:
    EMBEDDING_MODEL: "ibm-granite-30m"

jobs:
    replace-embedding-model:
        runs-on: ubuntu-latest

        steps:
        - uses: actions/checkout@v4

        - name: update-readme
          run: |
            CURRENT_MODEL=$(awk '/demonstrates that \*\*/{gsub(/.*demonstrates that \*\*/, ""); gsub(/\*\*.*/, ""); print; exit}' README.md) && sed -i.bak "s/${CURRENT_MODEL}/$EMBEDDING_MODEL/g" README.md && rm README.md.bak

        - name: Verify Changed files
          uses: tj-actions/verify-changed-files@v20
          id: changed_files
          with:
            files: README.md

        - name: commit-files
          if: steps.changed_files.outputs.files_changed == 'true'
          run: |
            git config --local user.email "github-actions[bot]@users.noreply.github.com"
            git config --local user.name "github-actions[bot]"
            git add README.md
            git commit -m "update README with top embedding model"

        - name: Create Pull Request
          if: steps.changed_files.outputs.files_changed == 'true'
          uses: peter-evans/create-pull-request@v7
          with:
            token: ${{ secrets.GITHUB_TOKEN }}
            title: "[Automatic] Update README with top embedding model"
